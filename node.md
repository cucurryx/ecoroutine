## 协程

#### 协程切换方式
- ucontext
操作系统提供，安全，性能稍低。ecoroutine实现采用了这种方式

- setjump, longjump
长跳转，缺点是不安全

- 汇编实现context_switch
兼容性差，性能好

- boost.context
性能较好、兼容性也不错

#### 协程栈
一般Linux线程栈采用8MB方案，这样不容易溢出，但是能够启动的线程较少。而为了满足较大数量协程同时启动，
需要采取小栈方案。

- 虚拟内存栈
每个协程的栈用`malloc`来默认分配1MB，因为虚拟内存空间一般足够，所以可以很好的解决栈大小和栈数量两者权衡的问题。
ecoroutine采用这种方式。

- 静态栈
所有协程都用静态栈，这样很容易出现栈溢出，而且每个协程分配的栈空间很小。


#### 协程调度
- 栈式调度
先进后出，类似于栈的调用。这样十分不公平

- 非对称协程调度
调度线程 -> 协程A -> 调度线程 -> 协程B -> 调度线程 -> …

比较公平。

- 对称协程调度
调度线程 -> 协程A -> 协程B -> 协程C -> 协程D -> 调度线程 -> …

相比非对称协程调度，切换次数比较少。




